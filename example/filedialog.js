var allExtensions,askToDeleteEntry,changeFolder,clearActionLinks,fileBrowserMode,fsToBrowse,icon,imitateDialog,makeActionLink,makeTable,rowOf3,setup,tellPage,validBrowserModes,indexOf=[].indexOf||function(e){for(var l=0,i=this.length;l<i;l++)if(l in this&&this[l]===e)return l;return-1};window.onmessage=function(e){var l;return e.data instanceof Array?(l=e.data.shift(),"function"!=typeof window[l]?console.log("Cannot call non-function:",l):window[l].apply(null,e.data)):console.log("Invalid message from page:",e.data)},tellPage=function(e){return window.parent.postMessage(e,"*")},fsToBrowse=new FileSystem(null),window.setFileSystemName=function(e){return fsToBrowse=new FileSystem(e),updateFileBrowser()},fileBrowserMode=null,validBrowserModes=["manage files","open file","save file","open folder","save in folder"],window.setFileBrowserMode=function(e){return indexOf.call(validBrowserModes,e)>=0&&(fileBrowserMode=e),updateFileBrowser()},window.fileBeingMoved={},window.fileToBeOpened=null,window.selectFile=function(e){return window.fileToBeOpened=e,tellPage(["selectedFile",e]),updateFileBrowser()},changeFolder=function(e){return fsToBrowse.cd(e),tellPage(["changedFolder",fsToBrowse.getCwd()]),selectFile(null)},imitateDialog=!1,window.setDialogImitation=function(e){return null==e&&(e=!0),imitateDialog=!!e,updateFileBrowser()},window.buttonClicked=function(e){var l,i,o;return"New folder"===e?(i=prompt("Enter name of new folder","My Folder"),void(fsToBrowse.mkdir(i)?updateFileBrowser():alert("That folder name is already in use."))):(l=[],"Save"===e&&((o=fsToBrowse.getCwd()).slice(-1)!==FileSystem.prototype.pathSeparator&&(o+=FileSystem.prototype.pathSeparator),l.push(o+saveFileName.value),fileBeingMoved.name&&(l.unshift(fileBeingMoved.full),e=fileBeingMoved.copy?fsToBrowse.cp(fileBeingMoved.full,o+saveFileName.value)?"Copied":"Copy failed":fsToBrowse.mv(fileBeingMoved.full,o+saveFileName.value)?"Moved":"Move failed")),"Save here"===e&&l.push(fsToBrowse.getCwd()),"Open"===e&&((o=fsToBrowse.getCwd()).slice(-1)!==FileSystem.prototype.pathSeparator&&(o+=FileSystem.prototype.pathSeparator),l.push(o+fileToBeOpened)),"Open this folder"===e&&(l.push(fsToBrowse.getCwd()),e="Open folder"),tellPage(["buttonClicked",e].concat(l)),window.fileBeingMoved={},selectFile(null),setFileBrowserMode("manage files"))},window.onload=setup=function(){var e;if(setFileBrowserMode("manage files"),changeFolder("."),(e=window.parent.tinymce.activeEditor.windowManager.getParams()).fsName&&setFileSystemName(e.fsName),e.mode)return setTimeout(function(){return setFileBrowserMode(e.mode)},0)},askToDeleteEntry=function(e){if(confirm("Are you sure you want to permantely delete "+e+"?"))return fsToBrowse.rm(e),updateFileBrowser()},window.updateFileBrowser=function(){var e,l,i,o,t,n,r,a,d,s,f,c,u,p,v,w,g,F,m,B,h,y,M,k,b,T,S,x,C,N;for(s={navigateFolders:!0,deleteFolders:!0,deleteFiles:!0,createFolders:!0,fileNameTextBox:!1,filesDisabled:!1,moveFiles:!0,moveFolders:!0,copyFiles:!0,extensionFilter:!1,selectFile:!1},C=fileBrowserMode?fileBrowserMode[0].toUpperCase()+fileBrowserMode.slice(1):"",t=[],"manage files"===fileBrowserMode?t=["New folder","Done"]:"save file"===fileBrowserMode?(s.deleteFolders=s.deleteFiles=s.moveFiles=s.moveFolders=s.copyFiles=!1,s.fileNameTextBox=!0,C="Save as...",t=["Cancel","Save"],imitateDialog&&t.unshift("New folder")):"save in folder"===fileBrowserMode?(s.deleteFolders=s.deleteFiles=s.moveFiles=s.moveFolders=s.copyFiles=!1,s.filesDisabled=!0,C="Save in...",t=["New folder","Cancel","Save here"]):"open file"===fileBrowserMode?(s.deleteFolders=s.deleteFiles=s.moveFiles=s.moveFolders=s.copyFiles=!1,s.extensionFilter=s.selectFile=!0,t=["Cancel","Open"]):"open folder"===fileBrowserMode&&(s.deleteFolders=s.deleteFiles=s.moveFiles=s.moveFolders=s.copyFiles=!1,s.filesDisabled=!0,t=["Cancel","Open this folder"]),a=[],fsToBrowse.getCwd()!==FileSystem.prototype.pathSeparator&&(e=icon("up-arrow"),l="Parent folder",s.navigateFolders&&(e=makeActionLink(e,"Go up to parent folder",o=function(){return changeFolder("..")}),l=makeActionLink(l,"Go up to parent folder",o)),a.push(rowOf3(e,l))),w=0,m=(b=fsToBrowse.ls(".","folders")).length;w<m;w++)u=b[w],e=icon("folder"),l=u,s.navigateFolders&&function(i){o=function(){return changeFolder(i)},e=makeActionLink(e,"Enter folder "+i,o),l=makeActionLink(l,"Enter folder "+i,o)}(u),i="",s.deleteFolders&&function(e){i+=makeActionLink(icon("delete"),"Delete folder "+e,function(){return askToDeleteEntry(e)})}(u),s.moveFolders&&function(e){i+=makeActionLink(icon("move"),"Move folder "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=fsToBrowse.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,fileBrowserMode="save file",updateFileBrowser()})}(u),a.push(rowOf3(e,l,i));for(c="*.*"===(c="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.options["undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0].value:void 0)?null:null!=c?c.slice(1):void 0,g=0,B=(T=fsToBrowse.ls(".","files")).length;g<B;g++)f=T[g],c&&f.slice(-c.length)!==c||(e=icon("text-file"),l=f,s.filesDisabled?l="<font color='#888888'>"+l+"</font>":s.selectFile&&function(i){o=function(){return selectFile(i)},e=makeActionLink(e,"Open "+i,o),l=makeActionLink(l,"Open "+i,o)}(f),s.fileNameTextBox&&function(i){o=function(){return saveFileName.value=i,saveBoxKeyPressed()},e=makeActionLink(e,"Save as "+i,o),l=makeActionLink(l,"Save as "+i,o)}(f),i="",s.deleteFiles&&function(e){i+=makeActionLink(icon("delete"),"Delete file "+e,function(){return askToDeleteEntry(e)})}(f),s.moveFiles&&function(e){i+=makeActionLink(icon("move"),"Move file "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=fsToBrowse.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!1,fileBrowserMode="save file",updateFileBrowser()})}(f),s.copyFiles&&function(e){i+=makeActionLink(icon("copy"),"Copy file "+e,function(){var l;return window.fileBeingMoved={name:e},fileBeingMoved.path=fsToBrowse.getCwd(),fileBeingMoved.full=fileBeingMoved.path,l=FileSystem.prototype.pathSeparator,fileBeingMoved.full.slice(-1)!==l&&(fileBeingMoved.full+=l),fileBeingMoved.full+=e,fileBeingMoved.copy=!0,fileBrowserMode="save file",updateFileBrowser()})}(f),d=rowOf3(e,l,i),fileToBeOpened===f&&(d="SELECT"+d),a.push(d));for(0===a.length&&a.push("(empty filesystem)"),v=makeTable(a),N=S="",s.fileNameTextBox&&(S+="File name: <input id='saveFileName' type='text' size=40 onkeyup='saveBoxKeyPressed(event);'/>"),s.extensionFilter&&(S+="File type: <select id='fileFilter' onchange='updateFileBrowser();'> "+function(){var e,l,i,o;for(o=[],e=0,l=(i=allExtensions()).length;e<l;e++)r=i[e],o.push("<option>"+r+"</option>");return o}().join("\n")+" </select>"),p=F=0,h=t.length;F<h;p=++F)n="","Open"!==(x=t[p])||fileToBeOpened||(n="disabled=true"),t[p]="<input type='button' value='  "+x+"  ' id='statusBarButton"+x+"' "+n+" onclick='buttonClicked(\""+x+"\");'/>";if(t=t.join(" "),imitateDialog?((k=fsToBrowse.getCwd())===FileSystem.prototype.pathSeparator&&(k+=" (top level)"),N="<table border=1 cellpadding=5 cellspacing=0 width=100% height=100%> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=33%> <b>"+C+"</b> </td> <td align=center width=34%> Folder: "+k+" </td> <td align=right width=33%> "+icon("close")+" </td> </tr> </table> </td> </tr> <tr> <td bgcolor=#fafafa valign=top>",S="   </td> </tr> <tr height=1%> <td bgcolor=#cccccc> <table border=0 cellpadding=0 cellspacing=0 width=100%> <tr> <td align=left width=50%> "+S+" </td> <td align=right width=50%> "+t+" </td> </tr> </table> </td> </tr> </table>"):(window.fileBeingMoved.name&&(S+=" &nbsp; "+t),S="<div style='position: absolute; bottom: 0; width: 90%; margin-bottom: 5px;'> <center>"+S+"</center> </div>"),M=("undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0)||("undefined"!=typeof fileBeingMoved&&null!==fileBeingMoved?fileBeingMoved.name:void 0),y="undefined"!=typeof fileFilter&&null!==fileFilter?fileFilter.selectedIndex:void 0,document.body.innerHTML=N+v+S,M&&"undefined"!=typeof saveFileName&&null!==saveFileName&&(saveFileName.value=M),y&&"undefined"!=typeof fileFilter&&null!==fileFilter&&(fileFilter.selectedIndex=y),saveBoxKeyPressed(),"undefined"!=typeof saveFileName&&null!==saveFileName)return saveFileName.focus()},window.saveBoxKeyPressed=function(e){var l;return l="undefined"!=typeof saveFileName&&null!==saveFileName?saveFileName.value:void 0,"undefined"!=typeof statusBarButtonSave&&null!==statusBarButtonSave&&(statusBarButtonSave.disabled=!l),"string"==typeof l&&tellPage(["saveFileNameChanged",l]),13===(null!=e?e.keyCode:void 0)?buttonClicked("Save"):27===(null!=e?e.keyCode:void 0)?buttonClicked("Cancel"):void 0},makeTable=function(e){var l,i,o,t,n,r,a,d,s;for(d="<table border=0 width=100% cellspacing=5 cellpadding=5>",i=o=0,a=l=Math.ceil(e.length/2);0<=a?o<a:o>a;i=0<=a?++o:--o)t="bgcolor=#e8e8e8","SELECT"===(n=e[i]).slice(0,6)&&(t="bgcolor=#ddddff",n=n.slice(6)),r="bgcolor=#e8e8e8",(s=e[i+l])?"SELECT"===s.slice(0,6)&&(r="bgcolor=#ddddff",s=s.slice(6)):r="",d+="<tr> <td width=50% "+t+">"+n+"</td> <td width=50% "+r+">"+(s||"")+"</td> </tr>";return d+"</table>"},window.actionLinks=[],clearActionLinks=function(){return[]},makeActionLink=function(e,l,i){var o;return o=actionLinks.length,actionLinks.push(i),"<a href='javascript:void(0);' title='"+l+"' onclick='actionLinks["+o+"]();'>"+e+"</a>"},icon=function(e){return"<img src='"+e+".png'>"},rowOf3=function(e,l,i){return null==i&&(i=""),"<table border=0 cellpadding=0 cellspacing=0 width=100%><tr> <td width=22>"+(e||"")+"</td> <td align=left>"+l+" &nbsp; &nbsp; </td> <td align=left width=66><nobr>"+i+"</nobr></td></tr></table>"},allExtensions=function(e){var l,i,o,t,n,r,a,d,s,f,c,u;for(null==e&&(e=null),e||(e=new FileSystem(fsToBrowse.getName())),u=["*.*"],o=0,r=(s=e.ls(".","files")).length;o<r;o++)(l=/\.[^.]*?$/.exec(s[o]))&&(l="*"+l,indexOf.call(u,l)<0&&u.push(l));for(t=0,a=(f=e.ls(".","folders")).length;t<a;t++){for(i=f[t],e.cd(i),n=0,d=(c=allExtensions(e)).length;n<d;n++)l=c[n],indexOf.call(u,l)<0&&u.push(l);e.cd("..")}return u.sort()};
//# sourceMappingURL=filedialog.js.map
